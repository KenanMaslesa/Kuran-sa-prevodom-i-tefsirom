<ion-content>
  <!-- <app-loader *ngIf="showLoader || mediaPlayerService.isLoading"></app-loader> -->
  <main *ngIf="dataStream$ | async as vm">
    <header>
      <ion-icon class="backButton" name="arrow-back-outline"></ion-icon>
      <div class="suraInfo">
        <h4>
          Sura name
        </h4>
        <p class="currentPage">
          {{quranService.currentPage}}
        </p>
      </div>

      <div class="bookmarks" *ngIf="sliderActiveIndex>0">
        <!--bookmarks icons-->
        <ion-icon *ngIf="!isCurrentPageInBookmarks" name="bookmark-outline"
          (click)="storage.addToBookmarks(vm.suraInfo, sliderActiveIndex); checkIsPageInBookmarks(vm.suraInfo)">
        </ion-icon>
        <ion-icon *ngIf="isCurrentPageInBookmarks" style="color:tomato;" name="bookmark"
          (click)="storage.removeFromBookmarks(vm.suraInfo, sliderActiveIndex); checkIsPageInBookmarks(vm.suraInfo)">
        </ion-icon>
        <!--bookmarks icons-->
      </div>

    </header>

    <div style="margin-top: 80px;">
      <div *ngFor="let ayah of vm.ayahsPerPages; let i = index">
        <div class="ayah" [class.active]="routeAyahId === ayah.ayaNumber" id="{{ayah.index}}">
          <!--progress-bar-->
          <ion-progress-bar
            *ngIf="mediaPlayerService.playingCurrentAyah === ayah.index && (mediaPlayerService.isPlaying || mediaPlayerService.isPaused)"
            color="primary" [value]="mediaPlayerService.currentTime/mediaPlayerService.getPlayerDuration()">
          </ion-progress-bar>
          <!--progress-bar-->

          <div class="ayah__header" (click)="ayah.showHeader = false">
            <h4 class="title">
              {{ayah.ayaNumber}}.
            </h4>
            <div class="icons">
              <!--favorite icons-->
              <ion-icon *ngIf="!storage.isFavorite(ayah)" name="heart-outline" (click)="storage.addToFavorites(ayah)">
              </ion-icon>
              <ion-icon *ngIf="storage.isFavorite(ayah)" class="red" name="heart"
                (click)="storage.removeFromFavorites(ayah)"></ion-icon>
              <!--favorite icons-->

              <ion-icon name="share-social"></ion-icon>
            </div>

            <!--player-->
            <div class="player" [class.show]="ayah.showHeader"
              *ngIf="mediaPlayerService.playingCurrentAyah === ayah.index || (!mediaPlayerService.isPlaying || mediaPlayerService.isPaused)">
              <ion-icon *ngIf="!mediaPlayerService.isPlaying && !mediaPlayerService.isPaused"
                (click)="playAyah(ayah,i+1);" name="play"></ion-icon>
              <!--scrollToElement(i)-->
              <ion-icon *ngIf="mediaPlayerService.isPlaying && !mediaPlayerService.isPaused"
                (click)="mediaPlayerService.removePlayer(); mediaPlayerService.playingCurrentAyah = null" name="stop">
              </ion-icon>
            </div>
            <!--player-->
          </div>

          <div class="ayah__info">
            <p class="arabic">{{ayah.aya}}</p>
            <div class="item">
              <span class="item__title">Prijevod:</span>
              <p class="item__content">{{ayah.korkutsTranslation}}</p>
            </div>
            <div>
              <span class="item__title">Tefsir:</span>
              <p class="item__content">{{ayah.tafsir}}</p>
            </div>
          </div>
        </div>
      </div>
    </div>

      <!--global player-->
      <ng-container *ngIf="mediaPlayerService.player">
        <div class="global-player">
          <ion-select class="left-select" [(ngModel)]="mediaPlayerService.selectedPlayOption" interface="popover"
            #playerOptions>
            <ion-select-option *ngFor="let option of mediaPlayerService.playOptions" [value]="option.value">
              {{option.name}}</ion-select-option>
          </ion-select>

          <div class="icon">
            <ion-icon class="icon__pause" name="pause" *ngIf="mediaPlayerService.isPlaying"
              (click)="mediaPlayerService.pauseAudio();">
            </ion-icon>
            <ion-icon class="icon__play" name="play" *ngIf="mediaPlayerService.isPaused"
              (click)="mediaPlayerService.continueAudio();">
            </ion-icon>
          </div>

          <ion-select class="right-select" interface="popover" #select [(ngModel)]="quranService.qari"
            (ngModelChange)="quranService.changeQari(select.value)" name="qari" #qari>
            <ion-select-option *ngFor="let item of quranService.qariList" value="{{item.identifier}}">
              {{item.englishName}}
            </ion-select-option>
          </ion-select>
        </div>

      </ng-container>
      <!--global player end-->

      <div class="swiper" color="primary">
        <div class="icon-wrapper left" [class.disabled]="quranService.currentPage === 604"
          (click)="onSuraChanged(+quranService.currentPage + 1)">
          <ion-icon style="margin-right: 30px;" class="next-icon" name="arrow-back-outline"></ion-icon>
        </div>
        <div class="currentPage">
          <ion-text>
            {{quranService.currentPage}}
          </ion-text>
          <!-- <ion-checkbox color="primary" (ionChange)="markPage($event)"
            [checked]="trackerService.isQuranPageCompleted(quranService.currentPage)"></ion-checkbox> -->
        </div>
        <div class="icon-wrapper right" [class.disabled]="quranService.currentPage === 1"
          (click)="onSuraChanged(+quranService.currentPage - 1)">
          <ion-icon style="margin-left: 30px;" class="prev-icon" name="arrow-forward-outline"></ion-icon>
        </div>
      </div>

  </main>
</ion-content>
