<!--exit fullscreen-->
<ion-icon class="exit-fullscreen" name="exit-outline" *ngIf="quranService.showHeaderAndTabs === false"
  (click)="quranService.showHeaderAndTabs = true"></ion-icon>
<!--exit fullscreen-->

<ion-header class="{{quranService.showHeaderAndTabs?'show':'hide'}}">
  <ion-toolbar color="primary" *ngIf="sura$ | async as sura">
    <ion-title style="font-size: 16px;" slot="start">
      {{sura.name.bosnianTranscription}}
    </ion-title>
        <!--bookmarks icons-->
        <ion-icon slot="end" *ngIf="!checkIsPageInBookmarks()" name="bookmark-outline"
          (click)="addTafsirBookmark(sura); quranService.showHeaderAndTabs=!quranService.showHeaderAndTabs">
        </ion-icon>
        <ion-icon slot="end" *ngIf="checkIsPageInBookmarks()" name="bookmark"
          (click)="deleteTafsirBookmark(sura); quranService.showHeaderAndTabs=!quranService.showHeaderAndTabs">
        </ion-icon>
        <!--bookmarks icons-->

        <!--fullscreen-->
        <ion-icon slot="end" name="expand-outline" (click)="quranService.showHeaderAndTabs = false"></ion-icon>
        <!--fullscreen-->
  </ion-toolbar>

</ion-header>

<ion-content>
  <!-- <app-loader *ngIf="showLoader || mediaPlayerService.isLoading"></app-loader> -->
  <main *ngIf="dataStream$ | async as vm" [class.fullscreen]="!quranService.showHeaderAndTabs">

    <div>
      <ion-slides #slider (ionSlideNextStart)="loadNext()" (ionSlidePrevStart)="loadPrev()" [options]="slideOpts">
        <ion-slide class="slide" [class.playingAyah]="mediaPlayerService.player" *ngFor="let page of ayahList">
          <div>
            <ng-container *ngFor="let ayah of page; let i = index">
              <div class="ayah" [class.active]="routeAyahId === ayah.ayaNumber" id="{{ayah.index}}">
                <!--progress-bar-->
                <ion-progress-bar
                  *ngIf="mediaPlayerService.playingCurrentAyah === ayah.index && (mediaPlayerService.isPlaying || mediaPlayerService.isPaused)"
                  color="primary" [value]="mediaPlayerService.currentTime/mediaPlayerService.getPlayerDuration()">
                </ion-progress-bar>
                <!--progress-bar-->

                <div class="ayah__header" (click)="ayah.showHeader = false">
                  <h4 class="title">
                    {{ayah.ayaNumber}}.
                  </h4>
                  <div class="icons">
                    <!--favorite icons-->
                    <ion-icon *ngIf="!storage.isFavorite(ayah)" name="heart-outline"
                      (click)="storage.addToFavorites(ayah)">
                    </ion-icon>
                    <ion-icon *ngIf="storage.isFavorite(ayah)" class="red" name="heart"
                      (click)="storage.removeFromFavorites(ayah)"></ion-icon>
                    <!--favorite icons-->

                    <ion-icon name="share-social"></ion-icon>
                  </div>

                  <!--player-->
                  <div class="player" [class.show]="ayah.showHeader"
                    *ngIf="mediaPlayerService.playingCurrentAyah === ayah.index || (!mediaPlayerService.isPlaying || mediaPlayerService.isPaused)">
                    <ion-icon *ngIf="!mediaPlayerService.isPlaying && !mediaPlayerService.isPaused"
                      (click)="playAyah(ayah.index);" name="play"></ion-icon>
                    <!--scrollToElement(i)-->
                    <ion-icon *ngIf="mediaPlayerService.isPlaying && !mediaPlayerService.isPaused"
                      (click)="mediaPlayerService.removePlayer(); mediaPlayerService.playingCurrentAyah = null"
                      name="stop"></ion-icon>
                  </div>
                  <!--player-->
                </div>

                <div class="ayah__info">
                  <p class="arabic">{{ayah.aya}}</p>
                  <div class="item">
                    <span class="item__title">Prijevod:</span>
                    <p class="item__content">{{ayah.korkutsTranslation}}</p>
                  </div>
                  <div>
                    <span class="item__title">Tefsir:</span>
                    <p class="item__content">{{ayah.tafsir}}</p>
                  </div>
                </div>
              </div>
            </ng-container>
          </div>
          <footer class="currentPageFooter">
            {{quranService.currentPage}}
          </footer>
        </ion-slide>
      </ion-slides>
    </div>

    <!--global player-->
    <ng-container *ngIf="mediaPlayerService.player">
      <div class="global-player">
        <ion-select class="left-select" [(ngModel)]="mediaPlayerService.selectedPlayOption" interface="popover"
          #playerOptions>
          <ion-select-option *ngFor="let option of mediaPlayerService.playOptions" [value]="option.value">
            {{option.name}}</ion-select-option>
        </ion-select>

        <div class="icon">
          <ion-icon class="icon__pause" name="pause" *ngIf="mediaPlayerService.isPlaying"
            (click)="mediaPlayerService.pauseAudio();">
          </ion-icon>
          <ion-icon class="icon__play" name="play" *ngIf="mediaPlayerService.isPaused"
            (click)="mediaPlayerService.continueAudio();">
          </ion-icon>
        </div>

        <ion-select class="right-select" interface="popover" #select [(ngModel)]="quranService.qari"
          (ngModelChange)="quranService.changeQari(select.value)" name="qari" #qari>
          <ion-select-option *ngFor="let item of quranService.qariList" value="{{item.identifier}}">
            {{item.englishName}}
          </ion-select-option>
        </ion-select>
      </div>

    </ng-container>
    <!--global player end-->
  </main>
</ion-content>
